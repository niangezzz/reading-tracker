{% extends 'tracker/base.html' %}

{% block title %}æˆ‘çš„ä¹¦æ¶{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>æˆ‘çš„ä¹¦æ¶</h1>
        <a href="{% url 'add_book' %}" class="btn btn-primary">+ æ·»åŠ ä¸€æœ¬æ–°ä¹¦</a>
    </div>

    <div class="row">
        {# --- â€œæƒ³è¯»â€ ä¹¦æ¶ --- #}
        <div class="col-md-4" data-aos="fade-up" data-aos-delay="100">
            <h3 class="mb-3">ğŸ’¡ æƒ³è¯» ({{ want_to_read_books.count }})</h3>
            {% for book in want_to_read_books %}
                {% include 'tracker/partials/book_card.html' %}
            {% empty %}
                <p class="text-muted">æ‚¨çš„æ„¿æœ›æ¸…å•æ˜¯ç©ºçš„ã€‚</p>
            {% endfor %}
        </div>

        {# --- â€œåœ¨è¯»â€ ä¹¦æ¶ --- #}
        <div class="col-md-4" data-aos="fade-up">
            <h3 class="mb-3">ğŸ“Œ åœ¨è¯» ({{ reading_books.count }})</h3>
            {% for book in reading_books %}
                {% include 'tracker/partials/book_card.html' %}
            {% empty %}
                <p class="text-muted">è¿˜æ²¡æœ‰æ­£åœ¨é˜…è¯»çš„ä¹¦ç±ã€‚</p>
            {% endfor %}
        </div>

        {# --- â€œå·²è¯»â€ ä¹¦æ¶ --- #}
        <div class="col-md-4" data-aos="fade-up" data-aos-delay="200">
            <h3 class="mb-3">âœ… å·²è¯» ({{ finished_books.count }})</h3>
            {% for book in finished_books %}
                {% include 'tracker/partials/book_card.html' %}
            {% empty %}
                <p class="text-muted">å¿«å»å®Œæˆä¸€æœ¬ä¹¦å§ï¼</p>
            {% endfor %}
        </div>
    </div>

    {# --- åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡† --- #}
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteModalLabel">ç¡®è®¤åˆ é™¤</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            æ‚¨ç¡®å®šè¦æ°¸ä¹…åˆ é™¤ä¹¦ç± <strong id="modalBookTitle"></strong> ä»¥åŠå®ƒçš„æ‰€æœ‰é˜…è¯»è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
            <form id="deleteForm" method="post">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">ç¡®è®¤åˆ é™¤</button>
            </form>
          </div>
        </div>
      </div>
    </div>
{% endblock %}


{# --- æ ¸å¿ƒä¿®æ­£ï¼šæŠŠ extra_js ä»£ç å—ä» content å—ä¸­ç§»åˆ°å¤–é¢ --- #}
{% block extra_js %}
<script>
const deleteConfirmModal = document.getElementById('deleteConfirmModal');

deleteConfirmModal.addEventListener('show.bs.modal', function (event) {
  // 1. è·å–è§¦å‘æ¨¡æ€æ¡†çš„é‚£ä¸ªæŒ‰é’®
  const button = event.relatedTarget;

  // 2. ä»æŒ‰é’®çš„ data-* å±æ€§ä¸­æå–ä¹¦ç±ä¿¡æ¯
  const bookId = button.getAttribute('data-book-id');
  const bookTitle = button.getAttribute('data-book-title');

  // 3. æ‰¾åˆ°æ¨¡æ€æ¡†å†…éƒ¨éœ€è¦æ›´æ–°çš„å…ƒç´ 
  const modalTitleElement = deleteConfirmModal.querySelector('#modalBookTitle');
  const deleteForm = deleteConfirmModal.querySelector('#deleteForm');

  // 4. æ›´æ–°æ¨¡æ€æ¡†çš„å†…å®¹
  modalTitleElement.textContent = `ã€Š${bookTitle}ã€‹`; // æ›´æ–°æç¤ºä¿¡æ¯é‡Œçš„ä¹¦å

  // 5. æ›´æ–°æ¨¡æ€æ¡†é‡Œåˆ é™¤è¡¨å•çš„æäº¤åœ°å€ (action)
  const deleteUrl = `/book/${bookId}/delete/`;
  deleteForm.setAttribute('action', deleteUrl);
});
</script>
{% endblock %}